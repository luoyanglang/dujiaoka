# ç‹¬è§’å¡æ•°æ’ä»¶å¸‚åœºéƒ¨ç½²é—®é¢˜å¤„ç†è®°å½•

**æ—¥æœŸ**ï¼š2025-12-07  
**çŠ¶æ€**ï¼šâœ… éƒ¨ç½²æˆåŠŸï¼Œæ’ä»¶å¸‚åœºåŠŸèƒ½å·²é…ç½®

---

## ğŸ“Š å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
1. **åç«¯ä»£ç **ï¼ˆæœ¬åœ° + æœåŠ¡å™¨ï¼‰
   - æ•°æ®åº“è¿ç§»æ–‡ä»¶ âœ…
   - æ¨¡å‹ï¼ˆPluginã€InstalledPluginï¼‰âœ…
   - æœåŠ¡å±‚ï¼ˆPluginLicenseServiceã€PluginInstallServiceï¼‰âœ…
   - æ§åˆ¶å™¨ï¼ˆPluginMarketControllerã€PluginControllerï¼‰âœ…
   - é˜²ç¯¡æ”¹ä¸­é—´ä»¶ï¼ˆPluginMarketGuardï¼‰âœ…
   - éƒ¨ç½²è„šæœ¬ âœ…
   - è·¯ç”±é…ç½® âœ…ï¼ˆapp/Admin/routes.phpï¼‰
   - åå°èœå• âœ…ï¼ˆé€šè¿‡ SQL æ·»åŠ ï¼‰

2. **æœåŠ¡å™¨ç¯å¢ƒ**
   - PHP 7.4 å®¹å™¨ï¼ˆhost ç½‘ç»œï¼‰âœ…
   - pdo_mysql æ‰©å±•å·²å®‰è£… âœ…
   - OpenResty å®¹å™¨è¿è¡Œæ­£å¸¸ âœ…
   - Redis å®¹å™¨è¿è¡Œæ­£å¸¸ âœ…
   - Composer ä¾èµ–å·²å®‰è£… âœ…
   - ç‹¬è§’å¡æ•°å·²å®‰è£… âœ…
   - æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ âœ…
   - æˆæƒç³»ç»Ÿé…ç½®å®Œæˆ âœ…
   - åå°æ’ä»¶ç®¡ç†é¡µé¢å¯è®¿é—® âœ…ï¼ˆ/admin/pluginsï¼‰

3. **ä»Šæ—¥å®Œæˆ**ï¼ˆ2025-12-07ï¼‰
   - è§£å†³ PHP å®¹å™¨ç½‘ç»œé—®é¢˜ï¼ˆhost ç½‘ç»œ + pdo_mysqlï¼‰
   - ä¿®å¤ PluginController å‘½åç©ºé—´é—®é¢˜
   - æ·»åŠ åå°è·¯ç”±é…ç½®
   - é€šè¿‡ SQL æ·»åŠ æ’ä»¶ç®¡ç†èœå•
   - åå°é¡µé¢æˆåŠŸè®¿é—®

### â¸ï¸ å¾…å®Œæˆ
1. å‰ç«¯é¡µé¢ï¼ˆ5ä¸ª Blade æ¨¡æ¿ï¼‰
   - market.blade.php - æ’ä»¶å¸‚åœº
   - detail.blade.php - æ’ä»¶è¯¦æƒ…
   - purchase.blade.php - è´­ä¹°é¡µé¢
   - activate.blade.php - æ¿€æ´»é¡µé¢
   - installed.blade.php - å·²å®‰è£…æ’ä»¶
2. å‰å°è·¯ç”±é…ç½®ï¼ˆroutes/web.phpï¼‰
3. åŠŸèƒ½æµ‹è¯•ï¼ˆè´­ä¹°æµç¨‹ã€æ¿€æ´»æµç¨‹ï¼‰

---

## ğŸ”§ å·²è§£å†³çš„é—®é¢˜

### é—®é¢˜1ï¼šPHP 7.4 å®‰è£… redis æ‰©å±•å¤±è´¥
**åŸå› **ï¼šå®¹å™¨æ— æ³•è®¿é—®å¤–ç½‘  
**è§£å†³**ï¼šæš‚æ—¶è·³è¿‡ï¼Œredis æ‰©å±•ä¸æ˜¯å¿…é¡»çš„

### é—®é¢˜2ï¼šç½‘ç«™ 524/504 è¶…æ—¶
**åŸå› **ï¼šOpenResty å’Œ PHP74 å®¹å™¨ç½‘ç»œä¸é€š  
**è§£å†³**ï¼š
1. OpenResty ä½¿ç”¨ host ç½‘ç»œæ¨¡å¼
2. PHP74 ç«¯å£æ˜ å°„ï¼š`127.0.0.1:9001->9000/tcp`
3. Nginx é…ç½®æ”¹ä¸ºï¼š`fastcgi_pass 127.0.0.1:9001;`

### é—®é¢˜3ï¼šPHP ç¦ç”¨å‡½æ•°
**åŸå› **ï¼šç‹¬è§’å¡æ•°éœ€è¦çš„å‡½æ•°è¢«ç¦ç”¨  
**è§£å†³**ï¼šåœ¨ 1Panel -> PHP 7.4 -> ç¦ç”¨å‡½æ•°åˆ—è¡¨ -> åˆ é™¤ä»¥ä¸‹å‡½æ•°
- `putenv`
- `proc_open`
- `pcntl_signal`
- `pcntl_alarm`

### é—®é¢˜4ï¼šPluginController å‘½åç©ºé—´é”™è¯¯
**åŸå› **ï¼šç»§æ‰¿äº†é”™è¯¯çš„ AdminController  
**è§£å†³**ï¼šä¿®æ”¹ä¸º `use Dcat\Admin\Controllers\AdminController;`

### é—®é¢˜5ï¼šåå°èœå•ä¸æ˜¾ç¤º
**åŸå› **ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰æ’ä»¶ç®¡ç†èœå•  
**è§£å†³**ï¼šé€šè¿‡ SQL æ·»åŠ èœå•å’Œæƒé™é…ç½®
```sql
INSERT INTO admin_menu (parent_id, `order`, title, icon, uri, created_at, updated_at) 
VALUES (0, 100, 'æ’ä»¶ç®¡ç†', 'feather icon-package', '/plugins', NOW(), NOW());
```

---

## ğŸ“ æœåŠ¡å™¨ä¿¡æ¯

### è¿æ¥ä¿¡æ¯
- **æœåŠ¡å™¨**ï¼š`root@103.121.92.216:1991`
- **SSHå¯†é’¥**ï¼š`C:\Users\Administrator\.ssh\id_rsa`
- **é¡¹ç›®è·¯å¾„**ï¼š`/opt/1panel/www/sites/ka.riyu.cc/index/`
- **å®¹å™¨å†…è·¯å¾„**ï¼š`/www/sites/ka.riyu.cc/index/`

### å®¹å™¨ä¿¡æ¯
- **PHP74**ï¼š`php74`ï¼ˆIP: 172.18.0.2ï¼Œç«¯å£æ˜ å°„ï¼š127.0.0.1:9001->9000ï¼‰
- **OpenResty**ï¼š`1Panel-openresty-X7Ke`ï¼ˆhost ç½‘ç»œæ¨¡å¼ï¼‰
- **Redis**ï¼š`1Panel-redis-RsHN`ï¼ˆIP: 172.18.0.3ï¼‰

### æ•°æ®åº“ä¿¡æ¯
- **ç±»å‹**ï¼šMySQLï¼ˆè…¾è®¯äº‘ï¼‰
- **åœ°å€**ï¼š`gz-cynosdbmysql-grp-nl0t3dlr.sql.tencentcdb.com:29074`
- **æ•°æ®åº“**ï¼š`dujiaokashu`
- **ç”¨æˆ·**ï¼š`root`

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. å¼€å‘å‰ç«¯é¡µé¢ï¼ˆå½“å‰ä»»åŠ¡ï¼‰
éœ€è¦åˆ›å»ºä»¥ä¸‹ Blade æ¨¡æ¿ï¼ˆå‚è€ƒç‹¬è§’å¡æ•°ç°æœ‰æ¨¡æ¿æ ·å¼ï¼‰ï¼š
- `resources/views/unicorn/plugins/market.blade.php` - æ’ä»¶å¸‚åœº
- `resources/views/unicorn/plugins/detail.blade.php` - æ’ä»¶è¯¦æƒ…
- `resources/views/unicorn/plugins/purchase.blade.php` - è´­ä¹°é¡µé¢
- `resources/views/unicorn/plugins/activate.blade.php` - æ¿€æ´»é¡µé¢
- `resources/views/unicorn/plugins/installed.blade.php` - å·²å®‰è£…æ’ä»¶

### 2. é…ç½®å‰å°è·¯ç”±
ç¼–è¾‘ `routes/web.php`ï¼Œæ·»åŠ æ’ä»¶å¸‚åœºè·¯ç”±ï¼ˆå¾…å®Œæˆï¼‰

### 3. æµ‹è¯•åŠŸèƒ½
- è®¿é—®æ’ä»¶å¸‚åœºï¼š`https://ka.riyu.cc/plugins`
- æµ‹è¯•è´­ä¹°æµç¨‹
- æµ‹è¯•æ¿€æ´»æµç¨‹
- æµ‹è¯•å®‰è£…/å¸è½½

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

### å®¹å™¨ç½‘ç»œé—®é¢˜
- OpenResty ä½¿ç”¨ host ç½‘ç»œï¼Œæ— æ³•åŠ å…¥å…¶ä»– Docker ç½‘ç»œ
- PHP74 åœ¨ 1panel-network ç½‘ç»œä¸­
- å®ƒä»¬é€šè¿‡å®¿ä¸»æœºç«¯å£é€šä¿¡ï¼š`127.0.0.1:9001`

### æ•°æ®åº“è¿æ¥
- å®¹å™¨å†…å¯èƒ½æ— æ³•è¿æ¥å¤–ç½‘æ•°æ®åº“
- å¦‚æœè¿ç§»å¤±è´¥ï¼Œä½¿ç”¨å®¿ä¸»æœº PHP æ‰§è¡Œ

### æ–‡ä»¶æƒé™
```bash
chmod -R 777 storage bootstrap/cache public/plugins
chown -R 1panel:1panel /opt/1panel/www/sites/ka.riyu.cc/index/
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å¼€å‘æ–¹æ¡ˆ**ï¼š`H:\codedujiao\dujiaoka-master\æ’ä»¶åå°è´­ä¹°é›†æˆæ–¹æ¡ˆ.md`
- **éƒ¨ç½²æµç¨‹**ï¼š`H:\codedujiao\dujiaoka-master\.kiro\steering\02-éƒ¨ç½²æµç¨‹.md`
- **APIæ–‡æ¡£**ï¼š`H:\code2\ruanjianshouquan\docs\APIæ–‡æ¡£.md`

---

## ğŸ¯ æ–°ä¼šè¯å¼€åœºç™½

```
ç»§ç»­å¼€å‘ç‹¬è§’å¡æ•°æ’ä»¶å¸‚åœº

å½“å‰çŠ¶æ€ï¼š
- âœ… åç«¯ä»£ç å·²å®Œæˆå¹¶éƒ¨ç½²
- âœ… æœåŠ¡å™¨ç¯å¢ƒå·²é…ç½®ï¼ˆPHP 7.4 + host ç½‘ç»œï¼‰
- âœ… æ•°æ®åº“è¿ç§»å·²å®Œæˆ
- âœ… åå°æ’ä»¶ç®¡ç†é¡µé¢å¯è®¿é—®ï¼ˆ/admin/pluginsï¼‰
- â¸ï¸ éœ€è¦ï¼šå¼€å‘å‰ç«¯é¡µé¢ï¼ˆ5ä¸ª Blade æ¨¡æ¿ï¼‰

æŸ¥çœ‹ï¼šH:\codedujiao\dujiaoka-master\éƒ¨ç½²é—®é¢˜å¤„ç†è®°å½•.md
```

---

**æœ€åæ›´æ–°**ï¼š2025-12-07 23:30  
**ä¸‹æ¬¡ç»§ç»­**ï¼šå¼€å‘å‰ç«¯é¡µé¢ + å‰å°è·¯ç”±é…ç½® + æµ‹è¯•è´­ä¹°æµç¨‹
